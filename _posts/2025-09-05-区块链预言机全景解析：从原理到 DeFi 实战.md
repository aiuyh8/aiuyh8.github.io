---
layout:     post
title:      åŒºå—é“¾é¢„è¨€æœºå…¨æ™¯è§£æï¼šä»åŸç†åˆ° DeFi å®æˆ˜
date:       2025-09-05
header-img: img/post-bg-desk.jpg
catalog: true
---

å½“é“¾ä¸Šæ™ºèƒ½åˆçº¦æƒ³è¦è°ƒç”¨ ETH å®æ—¶ä»·æ ¼ã€ä¸–ç•Œæ¯èµ›æœæˆ–èˆªç­å»¶è¯¯æ•°æ®æ—¶ï¼Œé¢„è¨€æœºä¾¿æˆä¸ºè¿æ¥åŒºå—é“¾ä¸å¤–éƒ¨ä¸–ç•Œçš„â€œæ•°æ®å¿«é€’å‘˜â€ã€‚æœ¬æ–‡å°†ä»åº•å±‚é€»è¾‘åˆ°ä¸»æµæ–¹æ¡ˆï¼Œä¸ºä½ æ‹†è§£é¢„è¨€æœºè¿è¡Œæœºåˆ¶ã€è¯„ä¼°ä¸­å¿ƒåŒ–ä¸å»ä¸­å¿ƒåŒ–çš„ä¼˜åŠ£ï¼Œå¹¶æ‰‹æŠŠæ‰‹å±•ç¤º DeFiã€NFTã€ä¿é™©ç­‰åœºæ™¯çš„å…·ä½“ä»£ç æ¥å…¥ç¤ºä¾‹ã€‚

---

## 1. ä»€ä¹ˆæ˜¯åŒºå—é“¾é¢„è¨€æœº

æ ¸å¿ƒå…³é”®è¯ï¼š`é¢„è¨€æœº`ã€`é“¾ä¸‹æ•°æ®`ã€`æ•°æ®å¯ä¿¡ä¼ è¾“`ã€`æ™ºèƒ½åˆçº¦`ã€`å»ä¸­å¿ƒåŒ–å–‚ä»·`

ä¸€å¥è¯å®šä¹‰ï¼šé¢„è¨€æœºæ˜¯ä¸€ç§å°†é“¾ä¸‹å¯ä¿¡æ•°æ®å†™å…¥é“¾ä¸Šåˆçº¦ï¼Œæˆ–å°†é“¾ä¸Šäº‹ä»¶å›å†™åˆ°å¤–éƒ¨ç³»ç»Ÿçš„ä¸­é—´ä»¶ã€‚æ²¡æœ‰å®ƒä»¬ï¼Œæ™ºèƒ½åˆçº¦åªèƒ½åœ¨å°é—­çš„ç½‘ç»œé‡Œåšâ€œå•æœºæ¸¸æˆâ€ã€‚

| ç»´åº¦ | ä¸¾ä¾‹è¯´æ˜ |
|---|---|
| æ•°æ®æ¥æº | ä¼ ç»Ÿ APIã€éšæœºæ•°å‘ç”Ÿå™¨ã€äº‹ä»¶ç»“æœ |
| ä¼ è¾“æ–¹å‘ | **è¾“å…¥é¢„è¨€æœº**ï¼šä»·æ ¼â†’åˆçº¦ï¼›**è¾“å‡ºé¢„è¨€æœº**ï¼šåˆçº¦â†’IoT è®¾å¤‡ï¼›**è®¡ç®—é¢„è¨€æœº**ï¼šé“¾ä¸‹å¤æ‚è®¡ç®— |

---

## 2. ä¸ºä»€ä¹ˆç¦»ä¸å¼€é¢„è¨€æœºï¼šåŒºå—é“¾çš„ç¡®å®šæ€§é™åˆ¶

ä»¥å¤ªåŠå¤©ç”Ÿâ€œæ’æ–¥â€ä¸ç¡®å®šæ€§ã€‚è‹¥åŒºå—é«˜åº¦ 12,345,678 æ—¶ï¼Œä¸¤æ¡èŠ‚ç‚¹å› è®¿é—® Yahoo Finance API å»¶è¿Ÿä¸åŒè€Œå¾—åˆ° 1,826 USDT å’Œ 1,824 USDT ä¸¤ç§ ETH ä»·æ ¼ï¼Œå°±ä¼šå¯¼è‡´åˆ†å‰â€”â€”è¿™æ˜¯è‡´å‘½çš„å…±è¯†äº‹æ•…ã€‚  
äºæ˜¯ï¼Œé“¾ä¸Šåªèƒ½ä¿¡ä»»çš„ä¸¤ç§ä¿¡æ¯ï¼š  
1. é“¾ä¸Šè´¦æˆ·çŠ¶æ€ï¼›  
2. åŒºå—è‡ªèº«å“ˆå¸Œå€¼ã€‚  

æ‰€æœ‰ä¸å¯é¢„çŸ¥çš„å®æ—¶æ•°æ®ï¼Œéƒ½å¿…é¡»å…ˆç”±é¢„è¨€æœº**å›ºåŒ–**åœ¨é“¾ä¸ŠåŒºå—ä¸­â€”â€”èŠ‚ç‚¹éšåè¯»å–åŒä¸€ä»½æ•°æ®ï¼Œä»è€Œç»§ç»­è¿›è¡Œå…±è¯†éªŒè¯ã€‚

ğŸ‘‰ [ç‚¹å‡»æŸ¥çœ‹ä¸­å¿ƒåŒ–ä¸å»ä¸­å¿ƒåŒ–é¢„è¨€æœºæ•°æ®ä¸€è‡´æ€§å·®å¼‚å®éªŒç»“æœ](https://okxdog.com/)

---

## 3. é¢„è¨€æœºçš„ä¸‰å¤§è®¾è®¡æ¨¡å¼

- **å³æ—¶è¯»å–**ï¼šç›´æ¥æŸ¥åˆçº¦çŠ¶æ€çš„æœ€æ–°å€¼ï¼Œä¾‹å¦‚ 24 h æ»šåŠ¨å‡ä»·ã€‚
- **å‘å¸ƒè®¢é˜…**ï¼šåˆçº¦ç›‘å¬ Topicï¼Œä¸€æ—¦æ–°æ•°å€¼å†™å…¥å³è§¦å‘äº‹ä»¶ã€‚
- **è¯·æ±‚å“åº”**ï¼šè‡ªå®šä¹‰è¯¢ä»·å•ï¼ˆrequest-responseï¼‰ã€‚åˆçº¦æäº¤ `Request`ï¼ŒèŠ‚ç‚¹è¿”å›å¸¦ç­¾åçš„ç­”æ¡ˆï¼Œå†å›è°ƒåˆ°ç›®æ ‡å‡½æ•°ã€‚

---

## 4. å·¥ä½œæµç¨‹æ‹†è§£ï¼šä¸€å¥é“¾ä¸Šè¯¢ä»·ï¼ŒèŠ‚ç‚¹æ€æ ·è·‘å®Œæœ€åä¸€å…¬é‡Œï¼Ÿ

1. **åˆçº¦è§¦å‘**ï¼š`createRequest("https://api.coingecko.com/api/v3/price?ids=ethereum&vs_c=usd","price")`
2. **äº‹ä»¶å¹¿æ’­**ï¼šOracle åˆçº¦æŠ›å‡º `NewRequest(id,url,attr)`ã€‚
3. **é“¾ä¸‹é‡‡é›†**ï¼šèŠ‚ç‚¹ GET è¯·æ±‚ â†’ JSON è§£æ â†’ `int256 price = 1826`ã€‚
4. **èšåˆä»²è£**ï¼šè‡³å°‘ 3 ä¸ªèŠ‚ç‚¹æŠ¥å‘Šç›¸åŒå€¼ï¼Œè§¦è¾¾æœ€å°æ³•å®šæ•°å³é˜ˆå€¼ã€‚
5. **é“¾ä¸Šå®šå‹**ï¼šæ›´æ–° `agreedValue`ï¼Œè°ƒç”¨ `UpdatedRequest()` é€šçŸ¥æ¶ˆè´¹åˆçº¦ã€‚

æ­¤æµç¨‹åœ¨ Pedro Costa çš„ [ç®€æ˜“å¼€æºç¤ºä¾‹](https://medium.com/@pedrodc/implementing-a-blockchain-oracle-on-ethereum-cedc7e26b49e) ä¸­æœ‰å®Œæ•´ Solidity ä»£ç å®ç°ï¼Œå¼€å‘è€…å¯ç›´æ¥ Fork æµ‹è¯•ã€‚

---

## 5. å»ä¸­å¿ƒåŒ– vs ä¸­å¿ƒåŒ–é¢„è¨€æœº

| æŒ‡æ ‡ | ä¸­å¿ƒåŒ– | å»ä¸­å¿ƒåŒ– |
|---|---|---|
|  correctness | å•ç‚¹ä½œæ¶é£é™©é«˜ | å¤šèŠ‚ç‚¹å…±è¯† + è´¨æŠ¼æƒ©ç½š |
| availability | æœåŠ¡å™¨å®•æœºå³å¤±æ•ˆ | å¤šèŠ‚ç‚¹é«˜å¯ç”¨ |
| æ¿€åŠ±å…¼å®¹ | åˆåŒä»˜è´¹æ— æ³•é˜²é¸½å­ | è´¨æŠ¼ä»£å¸ + å¥–æƒ©ç®—æ³• |
| gas æˆæœ¬ | ä½ | éšèŠ‚ç‚¹æ•°ä¸Šå‡ |

### å»ä¸­å¿ƒåŒ–â€œé«˜å¯ä¿¡â€ä¸‰æ¿æ–§

- **çœŸå®æ€§è¯æ˜**ï¼šTLS ä¼šè¯æ¡æ‰‹è„šæœ¬ + TEE å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼Œè‡ªè¯â€œæˆ‘æ²¡è¢« HTTP ä¸­é—´äººæ”»å‡»â€ã€‚
- **Schelling Point æŠ•ç¥¨**ï¼šèŠ‚ç‚¹æŠ¼ä»£å¸æƒ©ç½šæœºåˆ¶ï¼Œåç¦»ä¸­ä½æ•°è€… Slashï¼Œå¾ˆåƒâ€œå…ˆè¯´çœŸè¯å…ˆå¾—ç³–â€ã€‚
- **å£°èª‰ç³»ç»Ÿ**ï¼šè®°å½•å†å²ä¿¡èª‰ï¼Œå¾—åˆ†ä½èŠ‚ç‚¹æ¥ä¸åˆ°å•ã€‚

---

## 6. æ¡ˆä¾‹æ˜Ÿçƒï¼šä»é‡‘èä»·æ ¼åˆ°éšæœºå®ç®±

### 6.1 DeFi ä»·æ ¼ç›´è¾¾ï¼šæŠµæŠ¼ä¼°å€¼ã€æ¸…ç®—çº¿

```solidity
// æ¥ Chainlink ä¸»ç½‘ä»·æ ¼
import "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";
contract CollOracle {
    AggregatorV3Interface public priceFeed = AggregatorV3Interface(0x5f4eC3Df9cbd43714FE2740f5E3616155c5b8419);
    function getLatestEthPrice() public view returns(int) {
        (,int price,,,) = priceFeed.latestRoundData();
        return price; // è¿”å› 8 ä½å°æ•°
    }
}
```
è¯¥å–‚ä»·å®æ—¶å½±å“ Aaveã€Compound çš„æ¸…ç®—å¼•æ“ã€‚å¼€å‘è€…å¿…è¯» OpenZeppelin çš„[ä»·æ ¼æºå®‰å…¨æŒ‡å—](https://blog.openzeppelin.com/secure-smart-contract-guidelines-the-dangers-of-price-oracles/)ã€‚

ğŸ‘‰ [äº²æ‰‹è·‘é€š ETH ä»·æ ¼å®æ—¶è·å–è„šæœ¬ï¼Œä»…éœ€ 5 åˆ†é’Ÿ](https://okxdog.com/)

### 6.2 NFT éšæœºç›²ç›’ï¼šå¯éªŒè¯éšæœºæ•°

é“¾ä¸Š `blockhash` æ˜“è¢«çŸ¿å·¥å¹²é¢„ï¼Œæ”¹ç”¨ Chainlink VRFï¼š
```solidity
uint256 randomness = requestRandomWords(keyHash, subId, 3, 2500000, 1);
```
randomness ç» Layer2 å›ä¼  + è¯æ˜ç­¾åï¼Œç¡®ä¿ç”¨æˆ·å¼€ç›’ç»“æœä¸å¯é¢„æµ‹ã€‚

### 6.3 ä¿é™©ç†èµ”ï¼šå¤©æ°”æ•°æ®è§¦å‘èµ”ä»˜

ä½œç‰©ä¿é™©åˆçº¦è®¾å®šâ€œå•æ—¥é™é›¨ä¸è¶³ 2 mmâ€å³èµ”ä»˜ã€‚é€šè¿‡ 3 ä¸ªå›½å®¶æ°”è±¡å±€ API å»ä¸­å¿ƒåŒ–æ±‡æ€»ï¼Œå…±è¯†æˆåŠŸåè‡ªåŠ¨æ‰§è¡Œ USDC è½¬è´¦ã€‚

---

## 7. ä¸Šæ‰‹æ¸…å•ï¼šå¦‚ä½•ä¸ºè‡ªå·±çš„åº”ç”¨é›†æˆé¢„è¨€æœº

æ­¥éª¤å‘å¸ƒç‰ˆï¼š
1. **éœ€æ±‚ç›˜ç‚¹**ï¼šä½ éœ€è¦ä»·æ ¼ã€éšæœºæ•°è¿˜æ˜¯äº‹ä»¶ç»“æœï¼Ÿ
2. **ç­›é€‰æœåŠ¡**  
   - **é€šç”¨ä»·æ ¼**ï¼šChainlink Price Feeds  
   - **é«˜æ€§èƒ½ LST æŠ¥ä»·**ï¼šRedStone Oracles  
   - **ä¸€ç«™å¼è·¨é“¾**ï¼šBand Protocol  
   - **ä¹è§‚é¢„è¨€æœº**ï¼šUMA Oyster  
3. **æœ¬åœ° fork è°ƒè¯•**ï¼šHardhat + Infura æ¨¡æ‹Ÿä¸»ç½‘ forkï¼Œå…ˆè·‘é€šå•å…ƒæµ‹è¯•ã€‚
4. **å®¡è®¡ä¸å®‰å…¨**ï¼šä¸Šçº¿ä¹‹å‰ï¼ŒåŠ¡å¿…æ£€æŸ¥ä»·æ ¼é€šç¼©ã€æ—¶é—´åŠ æƒå¹³å‡ã€`latestRoundData()` è¿”å›å€¼æœ‰æ•ˆæ€§åŒºé—´ã€‚

---

## 8. å¸¸è§é—®é¢˜ FAQ

Q1ï¼šé¢„è¨€æœºèŠ‚ç‚¹è¢«é»‘å®¢æ”»å‡»æ€ä¹ˆåŠï¼Ÿ  
> å»ä¸­å¿ƒåŒ–é¢„è¨€æœºé€šè¿‡å¤šèŠ‚ç‚¹å†—ä½™ã€TLS ä¼šè¯è¯æ˜ã€æƒ©ç½šè´¨æŠ¼ä¸‰é‡é˜²çº¿é™ä½å•ç‚¹è¢«é»‘å½±å“ã€‚

Q2ï¼šä¸ºä»€ä¹ˆæœ‰æ—¶ä»·æ ¼å»¶è¿Ÿ 1-2 åˆ†é’Ÿï¼Ÿ  
> é“¾ä¸‹æ•°æ®åˆ·æ–°é¢‘ç‡ + èŠ‚ç‚¹å…±è¯† + åŒºå—æ‰“åŒ…å‡æœ‰å»¶è¿Ÿã€‚DeFi åœºæ™¯å¸¸æ­é… â€œæ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼ TWAPâ€ å¹³æ»‘æ³¢åŠ¨ã€‚

Q3ï¼šå¯ä»¥è‡ªå·±æ­èŠ‚ç‚¹åšé¢„è¨€æœºå—ï¼Ÿ  
> å¯ä»¥ï¼Œä½†éœ€è¿è¡Œé“¾ä¸‹å®ˆæŠ¤è¿›ç¨‹ã€æ”¯ä»˜ ETH æ‰‹ç»­è´¹ã€æ»¡è¶³å£°èª‰æˆ–è´¨æŠ¼é—¨æ§›ï¼›æ–°æ‰‹ç›´æ¥ä½¿ç”¨ç°æœ‰ç½‘ç»œæ›´ç»æµã€‚

Q4ï¼šæˆ‘ä»¬å¦‚ä½•éªŒè¯é¢„è¨€æœºç»™å‡ºçš„éšæœºæ•°çœŸçš„éšæœºï¼Ÿ  
> VRF æ–¹æ¡ˆä¼šé™„å¸¦å›ä¼  UNSH Signatureï¼Œåˆçº¦ç«¯ verify åå³å¯ä¸Šé“¾ç¡®å®šæ€§æ ¡éªŒã€‚

Q5ï¼šä¸»æµä»·æ ¼æºé—´å·®å¼‚è¶…å‡º 0.5% å¦‚ä½•å¤„ç†ï¼Ÿ  
> åœ¨åšæ¸…ç®—æˆ–è¡ç”Ÿå“å®šä»·æ—¶ï¼Œåº”é‡‡å–ä¸­ä½æ•°æˆ–æˆªå°¾å‡å€¼ç®—æ³•ï¼Œå¹¶åœ¨åˆçº¦é‡Œè®¾ç½® 0.3-1% å®¹é”™é˜ˆå€¼ä¸äººå·¥å¹²é¢„æ¥å£ã€‚

Q6ï¼šé¢„è¨€æœº gas è´¹å¤ªé«˜ï¼Œèƒ½å¦ L2 æ–¹æ¡ˆï¼Ÿ  
> RedStoneã€Pyth Network å·²æ¨å‡º Optimismã€Arbitrum ç‰ˆæœ¬ï¼Œä½å»¶è¿Ÿä½æˆæœ¬ï¼ŒåŒæ­¥åˆ°ä¸»ç½‘ä»…åœ¨æ¸…ç®—æ—¶è§¦å‘ã€‚

---

## 9. è¿›é˜¶é˜…è¯»

- ã€ŠSo You Want to Use a Price Oracleã€‹_samczsun_ï¼ˆå¿…è¯»å®‰å…¨æ„è¯†ï¼‰  
- ã€ŠDecentralised Oracles: a comprehensive overviewã€‹_Fabric Ventures_  
- è§†é¢‘ï¼šã€ŠOracles and the Expansion of Blockchain Utilityã€‹_Real Vision Finance_

---

æŠŠé¢„è¨€æœºå½“æ¡¥æ¢è€Œéå¤–æŒ‚ï¼Œä½ å°±èƒ½åœ¨é“¾ä¸Šé“¾ä¸‹ä¹‹é—´æ‰“é€šæ•°æ®ä»»ç£äºŒè„‰ã€‚ç°åœ¨ï¼Œå°±ç”¨ 10 è¡Œ Solidity æŠŠ ETH æœ€æ–°ä»·æ ¼æ¬è¿›åˆçº¦ï¼Œä½“éªŒå»ä¸­å¿ƒåŒ–ä¸–ç•Œçš„å®æ—¶å¿ƒè·³å§ï¼