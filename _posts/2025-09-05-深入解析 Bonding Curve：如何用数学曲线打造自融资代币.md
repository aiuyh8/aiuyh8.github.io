---
layout:     post
title:      深入解析 Bonding Curve：如何用数学曲线打造自融资代币
date:       2025-09-05
header-img: img/post-bg-desk.jpg
catalog: true
---

> “给我正确的激励，我便会给你想要的结果。”——查理·芒格

**bonding curve**（联合曲线）是当下最火的加密经济学原语之一：它用一段数学公式把代币供应量与价格实时绑定，让每一个参与者都能按照公开、可预测的价格买卖，而无需对手盘。本文将带你从 0 到 1 拆解联合曲线的工作原理、智能合约实现、以及两个高阶使用场景：自动化做市（AMM）与持续型组织（Continuous Organizations）。

---

## 目录
- 连续代币的四大特性  
- 联合曲线的数学内核  
- Solidity 实战：从公式到合约  
- 前端攻击与防呆设计  
- AMM：24×7 的自营交易所  
- Continuous Organization：没有 ICO 的永久融资  
- FAQ：新手最容易踩的 5 个坑  

---

## 连续代币的四大特性

连续代币（Continuous Token）是由联合曲线合约直接发行的资产，没有固定上限，却保持以下惊人特征：

1. **无限供应**  
2. **算法定价**  
3. **流动性即时可用**  
4. **滑动价格：n 比 n+1 便宜、比 n-1 贵**

当用户投入资金（通常是 ETH）时，合约会沿曲线“向上滑动”，增发出新代币；反之，当用户退还代币，合约会沿曲线“向下滑动”，销毁代币并返还 ETH。正因买压与卖压实时体现在价格上，早期买家有机会享受“低买高卖”红利。  

👉 [想亲手实验联合曲线的滑点效果？立即体验实时计算器！](https://okxdog.com/)

---

## 联合曲线的数学内核

### 基础公式

```text
当前价格 = 储备金余额 ÷ (连续代币总供应量 × 储备比率)
```

- **储备比率**（Reserve Ratio）介于 0-100%，它决定了价格敏感程度。  
- 当 RR=10%，曲线陡峭，微小交易量即可带来巨大价格波动；  
- 当 RR=90%，曲线接近直线，大单也只轻微撼价。  

### 进阶公式

| 操作 | 公式 |
|---|---|
| 输入 ETH 获取代币 | 见 PurchaseReturn |
| 返还代币取回 ETH | 见 SaleReturn |

它们通过积分实现，计算时需取曲线下面积，合约中则用 Bancor 提供的 Power 函数做精确近似。

---

## Solidity 实战：从公式到合约

下列精简片段将 `BancorBondingCurve.sol` 的核心函数抽丝剥茧：

1. `calculatePurchaseReturn()`：输入 ETH → 返回可得的连续代币数量。  
2. `calculateSaleReturn()`：输入连续代币 → 返回可提取的 ETH。

只需继承这一实用库，即可在 `ContinuousToken.sol` 中实现 `mint()` 与 `burn()`，达到一键买卖。  

_合约已在主网部署示例：输入任意金额立即可成交，无需挂单、撮合或授权。_

---

## 前端攻击与防呆设计

**front-running**（抢跑）是联合曲线最大的噩梦：攻击者监听 mempool，发现大额买单后立即高价插队，随后卖出套利。

**简单对策：**  
- 在合约层限制 `maxGasPrice`，超出限度的交易直接回滚；  
- 前端提示用户勿设置过高 gas，确保买卖公平排序。  

```solidity
modifier validGasPrice() {
    require(tx.gasprice <= maxGasPrice,"Gas too high");
    _;
}
```

---

## AMM：24×7 的自营交易所

传统交易所的双边挂单模式，在深度不足时极易出现“无人问津”。AMM 直接将 ETH 与代币存放进联合曲线合约：

1. 买家把 ETH 打入 Buy 函数 → 获得新铸代币；  
2. 卖家把代币打入 Sell 函数 → 立即收到 ETH；  

无需撮合，也无需苦等项目方放流动性。于是即使是刚起步的小众社区，也能拥有永不打烊的“自营盘”。

👉 [点我模拟一次无滑点秒杀挂单体验](https://okxdog.com/)

---

## Continuous Organization：没有 ICO 的永久融资

传统 ICO 一次性就把代币卖光，后续缺钱只能再融 B、C、D 轮。Continuous Organization 借助 DAT（去中心化自治信托）实现“边跑边卖”、永不封顶的持续融资：

- 用户随时把 ETH 换成 FAIR，代币由 DAT 即时铸造；  
- 资金一部分回流企业运营，一部分留在 DAT 做储备金；  
- 卖压永远有流动性兜底，无“砸盘即归零”风险。

如此一来，开发者专心致志做产品，投资人随时可进可退，社区始终共享成长红利。

---

## FAQ：新手最容易踩的 5 个坑

**Q1：价格和总供应量会一直涨吗？**  
A：涨或跌取决于资金流。净流入就沿曲线上行；净流出则缩水，曲线从不保证只涨不跌。

**Q2：设置储备比率=1% 岂不是暴利？**  
A：高收益伴随高波动，5 位数大单可能瞬间让价格翻五倍，也可能让池子清空。谨慎选择 RR。

**Q3：如何验证合约有没有后门？**  
A：核查是否使用开源库、reserveBalance 能否自由提取、Owner 权限是否可控。建议查阅 Certik、慢雾等审计报告。

**Q4：手续费怎么算？**  
A：将小额手续费滑入价差即可，常见做法是双曲线：买入价略高于卖出价，价差即为协议收入。

**Q5：连续代币可以跨链吗？**  
A：可以！通过跨链桥锁定主网代币，映射目标链同质资产；退出时再桥接回主网烧毁，整个过程联合曲线全程不变。

---

## 写在最后

联合曲线的魅力在于把“启发性博弈”装进一段优雅的代码：它模糊了众筹、交易所与组织架构的边界，给早期贡献者切实的激励，也为后来者提供安全垫。当越来越多的开发者在曲线函数上做实验，谁能率先找到最优的激励形状，谁就能跑出一条自下而上的加密高速公路。  

下一步，你已经掌握了公式、合约与场景，是时候动手写一条属于自己的联合曲线了。